var bb={log:function(e,t){var a="",n=new Date;a+=n.getFullYear()+"-"+("0"+(n.getMonth()+1)).slice(-2)+"-"+("0"+n.getMonth()).slice(-2),a+=" "+("0"+n.getHours()).slice(-2)+":"+("0"+n.getMinutes()).slice(-2)+":"+("0"+n.getSeconds()).slice(-2),console.log("["+a+"]%c "+e,"color: #e02437",t)}};bb.stream={init:function(){bb.stream.url("/screens/welcome/")},url:function(e){$(".js-streamer").attr("src",e),bb.log("Streamer","Changed frame to "+e)}},bb.tweetstream={loadedTweets:[],init:function(){bb.tweetstream.checkForUpdate(),setInterval(bb.tweetstream.checkForUpdate,3e4)},checkForUpdate:function(){var e=$("#tmpl-tweet").html();bb.log("Tweetstream","Checking for updates..."),Mustache.parse(e),$.ajax({dataType:"json",cache:!1,url:"/service/tweets.php"}).done(function(t){var a=$(".js-tweetstream"),n="";$.each(t.tweets,function(t,a){return $.inArray(a.id,bb.tweetstream.loadedTweets)<=-1?(bb.tweetstream.loadedTweets.push(a.id),n+=Mustache.render(e,a),bb.log("Tweetstream","Tweets inserted!"),void 0):(bb.log("Tweetstream","No more tweets to speak of."),!1)}),a.prepend($(n).hide().fadeIn()),a.children().each(function(e,t){var a=$(t);e>4?a.fadeOut(500,function(){a.remove()}):a.find("[data-timeago]").timeago()})}).fail(function(){bb.log("Tweetstream","Loading failed.")})}},bb.schedule={lastTimestamp:0,init:function(){bb.schedule.checkForUpdate(),setInterval(bb.schedule.checkForUpdate,62e3)},checkForUpdate:function(){var e=$("#tmpl-schedule").html(),t=Math.round((new Date).getTime()/1e3);bb.log("Schedule","Checking for updates..."),Mustache.parse(e),$.ajax({dataType:"json",cache:!1,url:"/service/schedule.json"}).done(function(a){$.each(a.schedule,function(a,n){if(n.timestamp>t){if(n.timestamp!=bb.schedule.lastTimestamp){bb.schedule.lastTimestamp=n.timestamp;var s=Mustache.render(e,n);return $(".js-schedule-placeholder").fadeOut(function(){$(this).html(s).fadeIn()}),bb.log("Schedule","Event updated!"),!1}return bb.log("Schedule","Event doesn't need updating."),!1}})}).fail(function(){bb.log("Schedule","Loading failed.")})}},$(document).ready(function(){bb.schedule.init(),bb.tweetstream.init(),bb.stream.init()});