var bb={},hello="/screens/hello/",goodbye="/screens/goodbye/",ponydrome="https://www.youtube.com/embed/videoseries?list=PL5oyPmRlu5uqI2fyqxDfnGuYmWSJqDCbS&autoplay=1";bb.stream={init:function(){bb.stream.url(hello),bb.tweetstream.init()},url:function(e){$("[data-stream-iframe]").attr("src",e)},toggle:function(){$("[data-stream]").toggleClass("stream--collapse")}},bb.tweetstream={init:function(){setInterval(function(){$("[data-timeago]").timeago()},1e3)},update:function(e){var t=$("[data-tweets-list]"),a=$("#tmpl-tweet").html();Mustache.parse(a);var n=Mustache.render(a,e);t.prepend($(n).hide().fadeIn()),t.children().each(function(e,t){var a=$(t);a.find("[data-timeago]").timeago(),e>15&&a.fadeOut(500,function(){a.remove()})})}},bb.schedule={lastTimestamp:0,init:function(){bb.schedule.update(),setInterval(bb.schedule.update,6e4)},toggle:function(){$("[data-schedule]").slideToggle()},update:function(){var e=$("#tmpl-schedule").html(),t=Math.round((new Date).getTime()/1e3);Mustache.parse(e),$.ajax({dataType:"json",cache:!1,url:"/service/schedule.json"}).done(function(a){var n=!1;if($.each(a.schedule,function(a,s){var i=new Date(s.timestamp).getTime();if(i>t){if(n=!0,i!=bb.schedule.lastTimestamp){bb.schedule.lastTimestamp=i,s.humanTime=new Date(i).toISOString();var o=Mustache.render(e,s);return $("[data-schedule-content]").fadeOut(function(){$(this).html(o).fadeIn(),jQuery.timeago.settings.allowFuture=!0,$(this).find("[data-timeago]").timeago()}),!1}return!1}}),0==n){var s=Mustache.render(e,{timestamp:"",event:"Nothing :("});$("[data-schedule-content]").fadeOut(function(){$(this).html(s).fadeIn()})}}).fail(function(e,t,a){console.log(e,t,a)})}},bb.message={display:function(e){var t=$("#tmpl-message").html(),a={};a.message=e,Mustache.parse(t),$("body").append(Mustache.render(t,a)),$(".message").hide().slideDown(),setTimeout(function(){$(".message").slideUp(function(){$(".message").remove()})},1e4)}},$(document).ready(function(){bb.stream.init(),bb.tweetstream.init(),bb.schedule.init()});